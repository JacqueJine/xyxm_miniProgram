(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/community/commDetail/commDetail"],{"53c2":function(t,e,n){"use strict";n.r(e);var o=n("d27d"),i=n("7782");for(var s in i)"default"!==s&&function(t){n.d(e,t,(function(){return i[t]}))}(s);n("61b8");var a,r=n("f0c5"),c=Object(r["a"])(i["default"],o["b"],o["c"],!1,null,"a0e0fbc4",null,!1,o["a"],a);e["default"]=c.exports},"61b8":function(t,e,n){"use strict";var o=n("8161"),i=n.n(o);i.a},7782:function(t,e,n){"use strict";n.r(e);var o=n("e55a"),i=n.n(o);for(var s in o)"default"!==s&&function(t){n.d(e,t,(function(){return o[t]}))}(s);e["default"]=i.a},8161:function(t,e,n){},b6bf:function(t,e,n){"use strict";(function(t){n("394a");o(n("66fd"));var e=o(n("53c2"));function o(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("543d")["createPage"])},d27d:function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return s})),n.d(e,"a",(function(){return o}));var o={uIcon:function(){return n.e("node-modules/uview-ui/components/u-icon/u-icon").then(n.bind(null,"21b6"))},uLoadmore:function(){return n.e("node-modules/uview-ui/components/u-loadmore/u-loadmore").then(n.bind(null,"811d"))},uPopup:function(){return n.e("node-modules/uview-ui/components/u-popup/u-popup").then(n.bind(null,"d202"))},uUpload:function(){return Promise.all([n.e("common/vendor"),n.e("node-modules/uview-ui/components/u-upload/u-upload")]).then(n.bind(null,"f218"))},helangCompress:function(){return n.e("components/helang-compress/helang-compress").then(n.bind(null,"d5f6"))}},i=function(){var t=this,e=t.$createElement,n=(t._self._c,""!==t.content?t.$u.timeFrom(t.create_time,!1):null),o=""!==t.content?t.__map(t.community_comment,(function(e,n){var o=t.__get_orig(e),i=t.$u.timeFrom(e.create_time,!1);return{$orig:o,g1:i}})):null,i=""!==t.content?t.__map(t.comment_other,(function(e,n){var o=t.__get_orig(e),i=t.$u.timeFrom(e.create_time,!1),s=t.__map(e.last,(function(e,n){var o=t.__get_orig(e),i=t.$u.timeFrom(e.create_time,!1);return{$orig:o,g3:i}}));return{$orig:o,g2:i,l1:s}})):null;t._isMounted||(t.e0=function(e){t.showReply=!t.showReply},t.e1=function(e){t.textFocus=!0},t.e2=function(e){t.textFocus=!1}),t.$mp.data=Object.assign({},{$root:{g0:n,l0:o,l2:i}})},s=[]},e55a:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=s(n("a34a")),i=n("8b93");function s(t){return t&&t.__esModule?t:{default:t}}function a(t,e,n,o,i,s,a){try{var r=t[s](a),c=r.value}catch(u){return void n(u)}r.done?e(c):Promise.resolve(c).then(o,i)}function r(t){return function(){var e=this,n=arguments;return new Promise((function(o,i){var s=t.apply(e,n);function r(t){a(s,o,i,r,c,"next",t)}function c(t){a(s,o,i,r,c,"throw",t)}r(void 0)}))}}var c=function(){n.e("components/helang-compress/helang-compress").then(function(){return resolve(n("d5f6"))}.bind(null,n)).catch(n.oe)},u={components:{helangCompress:c},data:function(){return{imgBaseUrl:getApp().globalData.imgBaseUrl,action:getApp().globalData.imgBaseUrl+"/common/upload/image.html",content:"",images:["/static/mine/name1.png"],user:{},community_classify:{},praise_num:0,share_num:0,is_praise:!1,create_time:null,showReply:!1,writeReply:!1,textFocus:!1,placeholder:"我也要说两句...",id:"",uid:"",comment_id:"",last_id:"",community_comment:[],comment_other:[],form:{imgs:[],content:""},page:1,page1:1,status1:"loadmore",iconType1:"flower",loadText1:{loadmore:"上拉或点击",loading:"努力加载中",nomore:"实在没有了"},status:"loadmore",iconType:"flower",loadText:{loadmore:"上拉或点击",loading:"努力加载中",nomore:"实在没有了"},shadowStyle:{backgroundImage:"none",paddingTop:"0",marginTop:"0"},myId:null,fast_id:"",fastName:"",navTop:getApp().globalData.navTop,navHeight:getApp().globalData.navHeight}},onShareAppMessage:function(e){var n=this;return"button"===e.from&&(0,i.sharePosts)({id:this.id}).then((function(e){200==e.code&&(t.showToast({title:e.message,duration:1500,icon:"none"}),n.share_num++)})),{title:"动态发布",path:"/pages/community/commDetail/commDetail?id="+this.id,imageUrl:"/static/dongtai/share_dt.png"}},onPullDownRefresh:function(){this.init(),t.stopPullDownRefresh()},onLoad:function(t){this.id=t.id,this.getData(),this.getCommentList()},onShow:function(){var e=this;t.getStorage({key:"user",success:function(t){e.myId=JSON.parse(t.data).id}})},onReachBottom:function(){this.loadingMore()},methods:{beforeUpload:function(e,n){var i=this;return r(o.default.mark((function s(){return o.default.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return t.showLoading({title:"检测中...",mask:!0}),s.prev=1,s.next=4,i.$refs.helangCompress.compress({src:n[e].url}).then(function(){var t=r(o.default.mark((function t(s){return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,i.$check.checkImg1(e,s,n);case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 4:s.next=9;break;case 6:s.prev=6,s.t0=s["catch"](1),console.log("e",s.t0);case 9:case"end":return s.stop()}}),s,null,[[1,6]])})))()},loadingMore:function(){"nomore"!=this.status&&(this.status="loading",this.page=++this.page,this.getCommentList())},initBox:function(){this.comment_other=[],this.page1=0,this.status1="loadmore",this.loadMore()},loadMore:function(){var e=this;"nomore"!=this.status1&&(this.status1="loading",this.page1=++this.page1,t.showLoading({title:"加载中..."}),(0,i.getPostsComment)({where:{posts_id:this.id,fast_id:this.fast_id},page:this.page1,limit:10}).then((function(n){t.hideLoading(),200==n.code?(e.comment_other=e.comment_other.concat(n.result),e.status1="loadmore"):e.status1="nomore"})))},likeComment:function(e,n,o,s){var a=this;(0,i.praiseComment)({id:e}).then((function(e){1==o?a.community_comment[n].is_praise=!a.community_comment[n].is_praise:2==o?a.comment_other[n].is_praise=!a.comment_other[n].is_praise:3==o&&(a.comment_other[n].last[s].is_praise=!a.comment_other[n].last[s].is_praise),200==e.code?(1==o?a.community_comment[n].praise_num++:2==o?a.comment_other[n].praise_num++:3==o&&a.comment_other[n].last[s].praise_num++,t.showToast({title:e.message,duration:1500,icon:"none"})):1==e.code&&(1==o?a.community_comment[n].praise_num--:2==o?a.comment_other[n].praise_num--:3==o&&a.comment_other[n].last[s].praise_num--)}))},init:function(){this.status="loadmore",this.page=1,this.community_comment=[],this.getCommentList()},getCommentList:function(){var t=this;(0,i.getPostsComment)({where:{posts_id:this.id,fast_id:0},page:this.page,limit:10}).then((function(e){200==e.code?t.community_comment=t.community_comment.concat(e.result):t.status="nomore"}))},onRemove:function(t,e){(0,i.delImages)(this.form.imgs[t]).then((function(t){})),this.form.imgs.splice(t,1)},onSuccess:function(e,n,o,i){200==e.code?this.form.imgs.push({path:e.result.src}):t.showToast({title:"上传失败",icon:"none"})},like:function(){var e=this;(0,i.praisePosts)({id:this.id}).then((function(n){e.is_praise=!e.is_praise,200==n.code?(e.praise_num++,t.showToast({title:n.message,icon:"none",duration:1500})):1==n.code?e.praise_num--:t.showToast({title:n.message,icon:"none",duration:1500})}))},getData:function(){var e=this;t.showLoading({title:"加载中..."}),(0,i.getPostsInfo)({id:this.id}).then((function(n){200==n.code&&(t.hideLoading(),e.uid=n.result.user_id,e.is_praise=n.result.is_praise,e.user=n.result.user,e.content=n.result.content,e.create_time=n.result.create_time,e.images=n.result.community_posts_imgs,e.praise_num=n.result.praise_num,e.share_num=n.result.share_num,e.community_classify=n.result.community_classify)}))},delPost:function(e,n){var o=this;t.showModal({title:"提示",content:"请确认进行此删除操作",success:function(s){s.confirm?(t.showLoading({title:"加载中...",mask:!0}),1==n?(0,i.delPosts)({id:e}).then((function(e){t.hideLoading(),t.showToast({title:e.message,icon:"none"}),200==e.code&&t.switchTab({url:"/pages/Tab/tabComm/community"})})):(0,i.delComment)({id:e}).then((function(e){t.hideLoading(),t.showToast({title:e.message,icon:"none"}),200==e.code&&(o.showReply?o.initBox():o.init())}))):s.cancel&&console.log("用户点击取消")}})},moreBtn:function(e,n,o){var i=this;t.showActionSheet({itemList:this.myId==n?["我要删除"]:["我要举报"],itemColor:this.myId==n?"#ff0000":"#000000",success:function(t){i.myId==n?i.delPost(e,o):i.showModal=!0},fail:function(t){}})},toMinePage:function(e){t.navigateTo({url:"/pages/community/minePage/minePage?id="+e})},showPop:function(e,n){var o=this,i=[];e.forEach((function(t){i.push(o.imgBaseUrl+t.path)})),t.previewImage({current:n,urls:i})},showhf:function(e,n){var o=this;t.showLoading({title:"加载中..."}),this.fast_id=e,this.fastName=n,this.comment_other=[],this.page1=1,this.status1="loadmore",(0,i.getPostsComment)({where:{posts_id:this.id,fast_id:e},page:this.page1,limit:10}).then((function(e){t.hideLoading(),200==e.code?(o.comment_other=o.comment_other.concat(e.result),o.showReply=!o.showReply):o.status1="nomore"}))},sendComment:function(){var e=this;if(""===this.form.content)return t.showToast({title:"请输入评论内容",icon:"none"}),!1;t.requestSubscribeMessage({tmplIds:["loosDS_rJeap9JOHwFnPOpjoNp3LPCkBuG68advTU_g","Q0dB1QJc9GcGSfT5tpj6GBbf53JiHhz6RDQZOVM6i3Y"],complete:function(){var n=r(o.default.mark((function n(s){var a;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,e.$check.checkTxt(e.form.content);case 3:a=e.form,e.comment_id&&(a.fast_id=e.comment_id),e.last_id&&(a.last_id=e.last_id),(0,i.comment)({id:e.id,data:a}).then((function(n){200==n.code?(e.writeReply=!1,e.form={content:"",imgs:[]},e.$refs.uUpload.clear(),e.showReply?e.initBox():e.init(),e.comment_id="",e.last_id="",t.showToast({title:n.message,icon:"none"})):t.showToast({title:n.message,icon:"none"})})),n.next=13;break;case 9:return n.prev=9,n.t0=n["catch"](0),e.form.content="",n.abrupt("return",!1);case 13:case"end":return n.stop()}}),n,null,[[0,9]])})));function s(t){return n.apply(this,arguments)}return s}()})},showWrite:function(t,e,n){t&&(this.comment_id=t,n&&(this.last_id=n)),this.placeholder=e?"回复："+e:"我也要说两句...",this.writeReply=!this.writeReply},toClub:function(){t.navigateTo({url:"/pages/community/club/club"})}}};e.default=u}).call(this,n("543d")["default"])}},[["b6bf","common/runtime","common/vendor"]]]);