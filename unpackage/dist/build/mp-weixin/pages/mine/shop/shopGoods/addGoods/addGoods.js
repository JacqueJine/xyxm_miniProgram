(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/mine/shop/shopGoods/addGoods/addGoods"],{"0e27":function(e,t,o){"use strict";o.r(t);var n=o("def5"),s=o("8f4e");for(var i in s)"default"!==i&&function(e){o.d(t,e,(function(){return s[e]}))}(i);o("4d81");var u,r=o("f0c5"),a=Object(r["a"])(s["default"],n["b"],n["c"],!1,null,"2a1e824e",null,!1,n["a"],u);t["default"]=a.exports},"3af1":function(e,t,o){},"4d81":function(e,t,o){"use strict";var n=o("3af1"),s=o.n(n);s.a},"8f4e":function(e,t,o){"use strict";o.r(t);var n=o("cee9"),s=o.n(n);for(var i in n)"default"!==i&&function(e){o.d(t,e,(function(){return n[e]}))}(i);t["default"]=s.a},b071:function(e,t,o){"use strict";(function(e){o("394a");n(o("66fd"));var t=n(o("0e27"));function n(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,o("543d")["createPage"])},cee9:function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(o("a34a")),s=o("3a43"),i=o("6c29"),u=o("8b93");function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t,o,n,s,i,u){try{var r=e[i](u),a=r.value}catch(c){return void o(c)}r.done?t(a):Promise.resolve(a).then(n,s)}function c(e){return function(){var t=this,o=arguments;return new Promise((function(n,s){var i=e.apply(t,o);function u(e){a(i,n,s,u,r,"next",e)}function r(e){a(i,n,s,u,r,"throw",e)}u(void 0)}))}}var l=function(){o.e("components/helang-compress/helang-compress").then(function(){return resolve(o("d5f6"))}.bind(null,o)).catch(o.oe)},d={components:{helangCompress:l},data:function(){return{fileList:[],isEdit:!1,hasIntroduce:!1,titleStyle:{width:"130rpx"},action:getApp().globalData.imgBaseUrl+"/common/upload/image.html",list:[],hotNum:0,shopHotNum:0,sel:[],formInfo:{store_id:1,class_id:[],name:"",price:"",hot:!1,goodsimage:"",num:"",introduce:"",picture:[],shelves:1},id:"",loading:!1}},methods:{changeHot:function(t){if(t){if(this.shopHotNum>=this.hotNum)return e.showToast({title:"热销商品已达到上限，无法添加",icon:"none"}),this.formInfo.hot=!1,!1;this.shopHotNum++}else{if(0==this.shopHotNum)return!1;this.shopHotNum--}},selClass:function(e,t){this.sel[e]==t?this.$set(this.sel,e,""):this.$set(this.sel,e,t)},toPage:function(t){var o="";1==t?o="/pages/mine/shop/shopGoods/goodsInfo/goodsInfo":2==t&&(o="/pages/mine/shop/shopGoods/goodsClass/goodsClass"),e.navigateTo({url:o})},beforeUpload:function(t,o){var s=this;return c(n.default.mark((function i(){return n.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return e.showLoading({title:"检测中...",mask:!0}),i.prev=1,i.next=4,s.$refs.helangCompress.compress({src:o[t].url}).then(function(){var e=c(n.default.mark((function e(i){return n.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,s.$check.checkImg1(t,i,o);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 4:i.next=9;break;case 6:i.prev=6,i.t0=i["catch"](1),console.log("e",i.t0);case 9:case"end":return i.stop()}}),i,null,[[1,6]])})))()},onSuccess:function(t,o,n,s){200==t.code?this.formInfo.goodsimage=t.result.src:e.showToast({title:t.message,icon:"none"})},onRemove:function(t,o){var n=this;(0,u.delImages)({path:this.forminfo.goodsimage}).then((function(t){e.showToast({title:t.message,icon:"none"}),200==t.code&&(n.formInfo.goodsimage="")}))},toList:function(t){var o=this;for(var n in this.formInfo.class_id=[],this.sel)""!=this.sel[n]&&this.formInfo.class_id.push(this.sel[n]);this.formInfo.class_id=this.formInfo.class_id.toString();var i=/(^[1-9](\d+)?(\.\d{1,2})?$)|(^[1-9]$)|(^\d\.[1-9]{1,2}$)|(^\d\.[0]{1}[1-9]{1}$|(^\d\.[1-9]{1}[0]{1}$)$)/;return 3==t?(e.showModal({title:"警告",content:"确定要删除该商品吗",success:function(t){t.confirm?(e.showLoading({title:"提交中……",mask:!0}),(0,s.delGoods)({id:o.id}).then((function(t){e.hideLoading(),e.showToast({title:t.message,icon:"none"}),200==t.code&&setTimeout((function(){e.navigateBack()}),1500)}))):t.cancel}}),!1):""==this.formInfo.name?(e.showToast({title:"请输入名称",icon:"none"}),!1):!i.test(this.formInfo.price)||Number(this.formInfo.price)>=1e4?(e.showToast({title:"请输入正确价格,且不能超过1万",icon:"none"}),!1):this.formInfo.class_id.length<1?(e.showToast({title:"请选择商品分类",icon:"none"}),!1):""==this.formInfo.goodsimage?(e.showToast({title:"请选择商品图片",icon:"none"}),!1):/^[1-9]\d*$/.test(this.formInfo.num)?(e.showLoading({title:"提交中……",mask:!0}),1!=t&&2!=t||(this.formInfo.shelves=t,(0,s.createGood)({data:this.formInfo}).then((function(t){e.hideLoading(),e.showToast({title:t.message,icon:"none"}),200==t.code&&setTimeout((function(){e.navigateBack()}),1500)}))),void(4==t&&(this.formInfo.id=this.id,(0,s.editGoods)({data:this.formInfo}).then((function(t){e.hideLoading(),e.showToast({title:t.message,icon:"none"}),200==t.code&&setTimeout((function(){e.navigateBack()}),1500)}))))):(e.showToast({title:"请输入正确库存",icon:"none"}),!1)}},onLoad:function(t){var o=this;(0,s.getClass)({id:1}).then((function(e){200==e.code&&(o.list=e.result)})),e.removeStorage({key:"goodsInfo",success:function(e){}}),e.setNavigationBarTitle({title:t.id?"编辑商品":"添加商品"}),t.id&&(this.isEdit=!0,(0,s.goodsDetail)({id:t.id}).then((function(t){if(200==t.code){for(var n in o.formInfo)o.formInfo[n]=t.result[n];if(o.id=t.result.id,o.fileList=[{url:getApp().globalData.imgBaseUrl+t.result.goodsimage}],""==t.result.introduce&&t.result.picture.length<1)o.hasIntroduce=!1;else{var s={};s.introduce=t.result.introduce,s.picture=t.result.picture,o.hasIntroduce=!0,e.setStorage({key:"goodsInfo",data:JSON.stringify(s)})}var i=t.result.class_id.split(",");for(var u in o.list)for(var r in i)o.list[u].id==i[r]&&(o.sel[u]=o.list[u].id);console.log(o.sel)}}))),(0,i.getInfoSystem)({key:"热销商品数量"}).then((function(e){200==e.code&&(o.hotNum=e.result.value)})),(0,s.hotCount)({id:1}).then((function(e){200==e.code&&(o.shopHotNum=e.result.count)}))},onShow:function(){var t=this;e.getStorage({key:"goodsInfo",success:function(e){var o=JSON.parse(e.data);t.hasIntroduce=!0,t.formInfo.introduce=o.introduce,t.formInfo.picture=o.picture}})}};t.default=d}).call(this,o("543d")["default"])},def5:function(e,t,o){"use strict";o.d(t,"b",(function(){return s})),o.d(t,"c",(function(){return i})),o.d(t,"a",(function(){return n}));var n={uField:function(){return o.e("node-modules/uview-ui/components/u-field/u-field").then(o.bind(null,"8b54"))},uCellItem:function(){return o.e("node-modules/uview-ui/components/u-cell-item/u-cell-item").then(o.bind(null,"92f3"))},uSwitch:function(){return o.e("node-modules/uview-ui/components/u-switch/u-switch").then(o.bind(null,"f3be"))},uUpload:function(){return Promise.all([o.e("common/vendor"),o.e("node-modules/uview-ui/components/u-upload/u-upload")]).then(o.bind(null,"f218"))},uButton:function(){return o.e("node-modules/uview-ui/components/u-button/u-button").then(o.bind(null,"53b8"))},helangCompress:function(){return o.e("components/helang-compress/helang-compress").then(o.bind(null,"d5f6"))}},s=function(){var e=this,t=e.$createElement;e._self._c},i=[]}},[["b071","common/runtime","common/vendor"]]]);