(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/Tab/tabComm/community"],{"081c":function(t,e,i){"use strict";i.r(e);var s=i("ba17"),a=i("38c2");for(var n in a)"default"!==n&&function(t){i.d(e,t,(function(){return a[t]}))}(n);i("1672");var o,u=i("f0c5"),c=Object(u["a"])(a["default"],s["b"],s["c"],!1,null,"8e1ffba8",null,!1,s["a"],o);e["default"]=c.exports},1672:function(t,e,i){"use strict";var s=i("e790"),a=i.n(s);a.a},"38c2":function(t,e,i){"use strict";i.r(e);var s=i("7dae"),a=i.n(s);for(var n in s)"default"!==n&&function(t){i.d(e,t,(function(){return s[t]}))}(n);e["default"]=a.a},"676c":function(t,e,i){"use strict";(function(t){i("394a");s(i("66fd"));var e=s(i("081c"));function s(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,i("543d")["createPage"])},"7dae":function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=i("8b93"),a=i("0b6e"),n=function(){i.e("components/popup/popup").then(function(){return resolve(i("dc6a"))}.bind(null,i)).catch(i.oe)},o={data:function(){return{imgBaseUrl:getApp().globalData.imgBaseUrl,value:"",showSelect:!1,showModal:!1,posts_auth:0,pageType:0,actType:{label:"",value:""},myId:null,navTop:getApp().globalData.navTop,navHeight:getApp().globalData.navHeight,tabList:["推荐","本校"],selectList:[],dataList:[],clubList:[],phbList:[],images:["/static/mine/name1.png"],isguan:!1,page:1,tabbarList:[],tabbarNum:0,my:{},status:"loadmore",iconType:"flower",loadText:{loadmore:"上拉或点击",loading:"努力加载中",nomore:"实在没有了"}}},components:{Popup:n},onShareAppMessage:function(e){var i=this;return"button"===e.from&&(t.setStorage({key:"isRefresh",data:!1,success:function(t){}}),(0,s.sharePosts)({id:e.target.dataset.id}).then((function(s){200==s.code&&(t.showToast({title:s.message,duration:1500}),i.dataList[e.target.dataset.index].share_num++)}))),{title:"动态发布",path:"/pages/community/commDetail/commDetail?id="+e.target.dataset.id,imageUrl:"/static/dongtai/share_dt.png"}},onLoad:function(){var e=this;t.showLoading({title:"加载中...",mask:!0}),(0,s.getCommunityClassify)({}).then((function(t){200==t.code&&(e.selectList=t.result,e.actType.value=t.result[0].id,e.actType.label=t.result[0].class_name)})),t.setStorage({key:"isRefresh",data:!0,success:function(t){}})},onShow:function(){var e=this;t.getStorage({key:"user",success:function(t){e.myId=JSON.parse(t.data).id}}),t.getStorage({key:"isRefresh",success:function(i){i.data?e.init():t.setStorage({key:"isRefresh",data:!0,success:function(t){}})}}),t.getStorageSync("token")&&(0,a.getUnreadOrEmpty)().then((function(e){200==e.code?t.showTabBarRedDot({index:3}):t.hideTabBarRedDot({index:3})}))},onPullDownRefresh:function(){this.init(),t.stopPullDownRefresh()},onReachBottom:function(){this.loadingMore()},onTabItemTap:function(){this.tabbarNum++,this.tabbarList.push((new Date).getTime()),0!=this.tabbarNum&&(t.pageScrollTo({scrollTop:0,duration:300}),this.tabbarNum=0),this.tabbarList.length>=2&&this.tabbarList[this.tabbarList.length-1]-this.tabbarList[this.tabbarList.length-2]<=1e3&&(this.init(),this.tabbarList=[])},methods:{isShowModal:function(t){this.showModal=t},getClub:function(){var e=this;t.showLoading({title:"加载中...",mask:!0}),(0,s.getMyClub)({where:{club_auth:this.posts_auth},page:this.page,limit:20}).then((function(i){200==i.code?i.result.list.length?e.clubList=e.clubList.concat(i.result.list):e.status="nomore":t.showToast({title:i.message,icon:"none"}),t.hideLoading()}))},getPhb:function(){var e=this;t.showLoading({title:"加载中...",mask:!0}),this.my={},(0,s.getClubLists)({where:{club_auth:this.posts_auth},page:1,limit:100}).then((function(i){200==i.code?i.result.list.length?(e.phbList=e.phbList.concat(i.result.list),e.phbList.forEach((function(t,i){t.user_id==e.myId&&(e.my=t,e.my.rank=1*i+1)}))):e.status="nomore":t.showToast({title:i.message,icon:"none"}),t.hideLoading()}))},loadingMore:function(){"nomore"!=this.status&&(this.status="loading",this.page=++this.page,2!=this.pageType&&3!=this.pageType?this.getList():2==this.pageType?this.getClub():this.pageType)},like:function(e,i){var a=this;(0,s.praisePosts)({id:e}).then((function(e){a.dataList[i].is_praise=!a.dataList[i].is_praise,200==e.code?(a.dataList[i].praise_num++,t.showToast({title:e.message,icon:"none",duration:1500})):1==e.code?a.dataList[i].praise_num--:t.showToast({title:e.message,icon:"none",duration:1500})}))},init:function(){var e=this;if(this.status="loadmore",this.page=1,t.showLoading({title:"加载中...",mask:!0}),2!=this.pageType&&3!=this.pageType){this.dataList=[];var i=this.pageType?this.actType.value:"";(0,s.getPostsLists)({where:{posts_auth:this.posts_auth,community_classify_id:i,community_club_id:0},page:this.page,limit:10}).then((function(i){200==i.code?e.dataList=e.dataList.concat(i.result):e.status="nomore",t.hideLoading()}))}else 2==this.pageType?(this.clubList=[],(0,s.getMyClub)({where:{club_auth:this.posts_auth},page:this.page,limit:20}).then((function(i){200==i.code?i.result.list.length?e.clubList=e.clubList.concat(i.result.list):e.status="nomore":t.showToast({title:i.message,icon:"none"}),t.hideLoading()}))):3==this.pageType&&(this.phbList=[],this.my={},(0,s.getClubLists)({where:{club_auth:this.posts_auth},page:1,limit:100}).then((function(i){200==i.code?i.result.list.length?(e.phbList=e.phbList.concat(i.result.list),e.phbList.forEach((function(t,i){t.user_id==e.myId&&(e.my=t,e.my.rank=1*i+1)}))):e.status="nomore":t.showToast({title:i.message,icon:"none"}),t.hideLoading()})))},getList:function(){var e=this;t.showLoading({title:"加载中...",mask:!0});var i=this.pageType?this.actType.value:"";(0,s.getPostsLists)({where:{posts_auth:this.posts_auth,community_classify_id:i,community_club_id:0},page:this.page,limit:10}).then((function(i){200==i.code?e.dataList=e.dataList.concat(i.result):e.status="nomore",t.hideLoading()}))},selectConfirm:function(t){this.actType=t[0],this.page=1,this.dataList=[],this.getList()},changeTab:function(t){this.posts_auth=t,this.status="loadmore",this.page=1,2!=this.pageType&&3!=this.pageType?(this.dataList=[],this.getList()):2==this.pageType?(this.clubList=[],this.getClub()):3==this.pageType&&(this.phbList=[],this.getPhb())},changeTab2:function(t){1==t&&1==this.pageType?this.showSelect=!0:2!=t&&3!=t?(this.pageType=t,this.status="loadmore",this.page=1,this.dataList=[],this.getList()):2==t?(this.pageType=t,this.status="loadmore",this.page=1,this.clubList=[],this.getClub()):3==t&&(this.pageType=t,this.status="loadmore",this.page=1,this.phbList=[],this.getPhb())},clubBtn:function(){var e=this;t.showActionSheet({itemList:["加入社团","创建社团"],success:function(i){i.tapIndex?e.addClub():t.navigateTo({url:"/pages/community/searchClub/searchClub"})},fail:function(t){console.log(t.errMsg)}})},delPost:function(e){var i=this;t.showModal({title:"提示",content:"请确认进行此删除操作",success:function(a){a.confirm?(t.showLoading({title:"加载中...",mask:!0}),(0,s.delPosts)({id:e}).then((function(e){t.hideLoading(),t.showToast({title:e.message,icon:"none"}),200==e.code&&i.init()}))):a.cancel&&console.log("用户点击取消")}})},moreBtn:function(e,i){var s=this;t.showActionSheet({itemList:this.myId==i?["我要删除"]:["我要举报"],itemColor:this.myId==i?"#ff0000":"#000000",success:function(t){s.myId==i?s.delPost(e):s.showModal=!0},fail:function(t){}})},showPop:function(e,i){var s=this;t.setStorage({key:"isRefresh",data:!1,success:function(t){}});var a=[];e.forEach((function(t){a.push(s.imgBaseUrl+t.path)})),t.previewImage({current:i,urls:a})},toClub:function(e){t.navigateTo({url:"/pages/community/club/club?id="+e})},toMinePage:function(e){t.navigateTo({url:"/pages/community/minePage/minePage?id="+e})},onSearch:function(){t.navigateTo({url:"/pages/community/commSearch/commSearch"})},back:function(){t.navigateBack()},addClub:function(){t.navigateTo({url:"/pages/community/club/addClub/addClub"})},addComm:function(){t.navigateTo({url:"/pages/community/addComm/addComm?type=1"})},toDetail:function(e){t.navigateTo({url:"/pages/community/commDetail/commDetail?id="+e})}}};e.default=o}).call(this,i("543d")["default"])},ba17:function(t,e,i){"use strict";i.d(e,"b",(function(){return a})),i.d(e,"c",(function(){return n})),i.d(e,"a",(function(){return s}));var s={uIcon:function(){return i.e("node-modules/uview-ui/components/u-icon/u-icon").then(i.bind(null,"21b6"))},uLoadmore:function(){return i.e("node-modules/uview-ui/components/u-loadmore/u-loadmore").then(i.bind(null,"811d"))},uReadMore:function(){return i.e("node-modules/uview-ui/components/u-read-more/u-read-more").then(i.bind(null,"4de6"))},uSelect:function(){return i.e("node-modules/uview-ui/components/u-select/u-select").then(i.bind(null,"cde0"))}},a=function(){var t=this,e=t.$createElement,i=(t._self._c,t.selectList&&2!=t.pageType&&3!=t.pageType?t.__map(t.dataList,(function(e,i){var s=t.__get_orig(e),a=t.$u.timeFrom(e.create_time,!1);return{$orig:s,g0:a}})):null);t.$mp.data=Object.assign({},{$root:{l0:i}})},n=[]},e790:function(t,e,i){}},[["676c","common/runtime","common/vendor"]]]);